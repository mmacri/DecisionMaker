<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CIP-007 System Security Management | Guided Training</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #0b1221;
      --panel: #0f172a;
      --card: #111827;
      --border: #1f2937;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --accent: #38bdf8;
      --accent-2: #22c55e;
      --warning: #fbbf24;
      --radius: 14px;
      font-synthesis: none;
      text-rendering: optimizeLegibility;
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f6f7fb;
        --panel: #ffffff;
        --card: #ffffff;
        --border: #d1d5db;
        --text: #0f172a;
        --muted: #4b5563;
        --accent: #0d6efd;
        --accent-2: #16a34a;
        --warning: #d97706;
      }
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
      min-height: 100vh;
      display: grid;
      grid-template-columns: 320px 1fr;
    }

    aside {
      background: var(--panel);
      border-right: 1px solid var(--border);
      padding: 1.25rem 1rem;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
    }

    main {
      min-height: 100vh;
      padding: 1.5rem;
    }

    h1, h2, h3, h4 { margin: 0; color: var(--text); }

    .module-meta {
      background: linear-gradient(150deg, rgba(56, 189, 248, 0.2), rgba(34, 197, 94, 0.18));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .module-meta p { margin: 0.25rem 0 0; color: var(--muted); }

    .progress {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 0.75rem 0 0.5rem;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .progress span { color: var(--text); font-weight: 700; }

    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    nav button {
      width: 100%;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      padding: 0.65rem 0.75rem;
      text-align: left;
      border-radius: 12px;
      cursor: pointer;
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 0.6rem;
      align-items: center;
      transition: border-color 160ms ease, background 160ms ease;
    }

    nav button:hover { border-color: var(--accent); }

    nav button.active { border-color: var(--accent); background: rgba(56, 189, 248, 0.08); }

    nav button:disabled {
      opacity: 0.55;
      cursor: not-allowed;
    }

    .check { color: var(--accent-2); font-weight: 900; }

    .lock { color: var(--warning); font-weight: 900; }

    .pill.warning { background: rgba(251, 191, 36, 0.15); border-color: rgba(251, 191, 36, 0.5); }

    .sticky-header {
      position: sticky;
      top: 0;
      z-index: 4;
      background: var(--panel);
      padding: 0.75rem 1rem;
      margin-bottom: 0.75rem;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .back-top {
      position: fixed;
      bottom: 18px;
      right: 18px;
      padding: 0.65rem 0.9rem;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      cursor: pointer;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.25);
      z-index: 6;
    }

    .page {
      display: none;
      max-width: 1100px;
      margin: 0 auto;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.25);
      min-height: calc(100vh - 3rem);
      position: relative;
    }

    .page.active { display: block; }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      background: rgba(56, 189, 248, 0.12);
      color: var(--text);
      border: 1px solid rgba(56, 189, 248, 0.35);
      font-weight: 700;
      letter-spacing: 0.02em;
      margin-bottom: 0.75rem;
    }

    .lead { color: var(--muted); margin: 0.5rem 0 1rem; font-size: 1.05rem; }

    .grid { display: grid; gap: 1rem; }

    .two-col { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }

    ul { margin: 0.4rem 0 0.4rem 1.25rem; }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
    }

    .cta {
      display: flex;
      justify-content: space-between;
      gap: 0.75rem;
      margin-top: 1.25rem;
    }

    .cta button {
      flex: 1;
      font: inherit;
      padding: 0.8rem 0.9rem;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: linear-gradient(160deg, var(--card), rgba(34, 197, 94, 0.08));
      color: var(--text);
      cursor: pointer;
      transition: transform 160ms ease, border-color 160ms ease;
    }

    .cta button:hover { transform: translateY(-1px); border-color: var(--accent); }

    .next { background: linear-gradient(160deg, var(--card), rgba(56, 189, 248, 0.12)); }

    .step-hint { color: var(--muted); font-size: 0.95rem; margin-bottom: 0.5rem; }

    .table { display: grid; grid-template-columns: repeat(4, 1fr); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .table div { padding: 0.75rem 0.85rem; border-bottom: 1px solid var(--border); }
    .table div:nth-child(4n+1) { background: rgba(56, 189, 248, 0.06); font-weight: 700; }
    .table div:nth-child(4n+2) { background: rgba(34, 197, 94, 0.06); }
    .table div:nth-child(4n+3) { background: rgba(56, 189, 248, 0.03); }
    .table div:nth-child(4n+4) { background: rgba(34, 197, 94, 0.03); }

    .scenario { border: 1px dashed var(--border); border-radius: 12px; padding: 0.75rem 1rem; margin-bottom: 0.75rem; background: rgba(56, 189, 248, 0.05); }

    .quiz { display: grid; gap: 1rem; }

    .question { border: 1px solid var(--border); border-radius: 12px; padding: 0.9rem; background: var(--card); }

    .options { display: grid; gap: 0.45rem; margin-top: 0.5rem; }

    .options button {
      text-align: left;
      padding: 0.65rem 0.75rem;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      cursor: pointer;
    }

    .options button.correct { border-color: var(--accent-2); background: rgba(34, 197, 94, 0.12); }
    .options button.incorrect { border-color: #f87171; background: rgba(248, 113, 113, 0.12); }

    .feedback { color: var(--muted); margin-top: 0.35rem; }

    .locked { color: var(--warning); font-weight: 700; margin-bottom: 0.5rem; }

    @media (max-width: 1080px) {
      body { grid-template-columns: 1fr; }
      aside { height: auto; position: static; border-right: none; border-bottom: 1px solid var(--border); }
      main { padding: 1rem; }
      .page { min-height: auto; }
    }
  </style>
</head>
<body>
  <div style="background:#0ea5e9;color:#0f172a;padding:12px 16px;border-bottom:4px solid #0284c7;text-align:center;font-weight:700;">
    New guided version available! <a href="./cip007/index.html" style="color:#0b1526;background:#fbbf24;padding:6px 10px;border-radius:8px;text-decoration:none;font-weight:700;">Open CIP-007 Guided Training</a>
  </div>
  <aside aria-label="Persistent navigation">
    <div class="module-meta">
      <p class="pill">CIP-007 · System Security Management</p>
      <h2 style="margin:0;">Guided Training</h2>
      <p>Mission control for the rebuilt CIP-007 learning experience.</p>
        <div class="progress"><span id="progress-count">1 / 18</span><span id="progress-text">Sections completed</span></div>
    </div>
    <nav aria-label="Module sections">
      <ul id="nav-list"></ul>
    </nav>
  </aside>

  <main>
    <section id="landing" class="page active" data-title="Module Landing Page">
      <p class="pill">Mission Control</p>
      <h1>CIP-007: System Security Management</h1>
      <p class="lead">Learn how to keep critical OT systems secure, monitored, and controlled so cyber incidents are prevented, detected, and contained before they impact operations.</p>
      <div class="grid two-col">
        <div class="card">
          <h3>What you will learn</h3>
          <ul>
            <li>How CIP-007 protects operational technology</li>
            <li>Your role in system security management</li>
            <li>What each CIP-007 requirement actually expects</li>
            <li>How security controls apply in real OT scenarios</li>
            <li>How to verify compliance in day-to-day operations</li>
          </ul>
        </div>
        <div class="card">
          <h3>Who this is for</h3>
          <ul>
            <li>OT Operators</li>
            <li>System Administrators</li>
            <li>Security Teams</li>
            <li>Compliance &amp; Audit Staff</li>
          </ul>
          <p><strong>Estimated time:</strong> 25–35 minutes</p>
        </div>
      </div>
      <div style="margin-top:1.25rem; display:flex; gap:0.75rem;">
        <button class="next" id="start-training" aria-label="Start the guided training">▶ Start Training</button>
        <button data-next="setup" class="next">Go to setup</button>
      </div>
      <p class="lead" style="margin-top:1rem; color:var(--muted);">No scrolling required. Follow the prompts to move through each section.</p>
    </section>

    <section id="setup" class="page" data-title="Learner Setup">
      <div class="sticky-header">
        <strong>Role- and goal-based flow</strong> — Tailor the module to your needs to surface required sections and unlock audit etiquette when needed.
      </div>
      <p class="pill">Step 1 — Personalize</p>
      <h2>Tell us about you</h2>
      <p class="lead">Your selections are stored locally to personalize navigation, show the right checklist gates, and populate certificates.</p>
      <div class="grid two-col">
        <div class="card">
          <label>Full name<br />
            <input id="learner-name" type="text" placeholder="Preferred display name" style="width:100%;padding:0.65rem;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text);" />
          </label>
          <p class="lead">This name will appear on your completion certificate.</p>
        </div>
        <div class="card">
          <label>Role<br />
            <select id="learner-role" style="width:100%;padding:0.65rem;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text);">
              <option value="">Select your role</option>
              <option>Operator</option>
              <option>System Administrator</option>
              <option>Security Analyst</option>
              <option>Compliance / Audit</option>
            </select>
          </label>
          <label style="margin-top:0.75rem;">Learning goal<br />
            <select id="learner-goal" style="width:100%;padding:0.65rem;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text);">
              <option value="">Pick a focus</option>
              <option>Basic awareness</option>
              <option>Operational readiness</option>
              <option>Audit preparation</option>
            </select>
          </label>
          <p class="lead" id="goal-note">Select a goal to see required steps.</p>
        </div>
      </div>
      <div class="cta">
        <button data-prev="landing">Back</button>
        <button id="save-setup" class="next" data-next="introduction">Save and continue</button>
      </div>
    </section>

    <section id="introduction" class="page" data-title="Introduction">
      <p class="pill">Step 1 — Learn the Purpose</p>
      <h2>What Is CIP-007?</h2>
      <p class="lead">CIP-007 focuses on protecting the systems that control and monitor critical infrastructure. It ensures systems are configured securely, kept up to date, monitored for problems, and accessed only by authorized users.</p>
      <div class="grid two-col">
        <div class="card">
          <h3>Why It Exists</h3>
          <p>Operational systems were not designed with cybersecurity in mind. CIP-007 exists to reduce the risk that common system weaknesses turn into operational disruptions or safety events.</p>
        </div>
        <div class="card">
          <h3>System Security Management in OT</h3>
          <p>Know what services are running, keep systems patched, prevent malware, watch for security events, control access, and secure remote connections—without disrupting operations.</p>
        </div>
      </div>
      <div class="cta">
        <button data-next="training-flow" class="next">Next: Training Flow</button>
      </div>
    </section>

    <section id="training-flow" class="page" data-title="Training Flow">
      <p class="pill">Step 2 — Understand the Journey</p>
      <h2>How This Training Works</h2>
      <ol>
        <li>Learn the purpose</li>
        <li>Understand your role</li>
        <li>Review each requirement</li>
        <li>Apply through scenarios</li>
        <li>Verify understanding</li>
        <li>Download the checklist</li>
        <li>Mark completion</li>
      </ol>
      <p class="lead">You will see this flow referenced on every requirement page: “You are on Step 3 of 7.”</p>
      <div class="cta">
        <button data-prev="introduction">Back</button>
        <button data-next="role-guidance" class="next">Next: Role Guidance</button>
      </div>
    </section>

    <section id="role-guidance" class="page" data-title="Role Guidance">
      <p class="pill">Step 2 — Your Role</p>
      <h2>Role-Based Guidance</h2>
      <div class="grid two-col">
        <div class="card">
          <h3>OT Operators</h3>
          <p><strong>You are responsible for</strong></p>
          <ul>
            <li>Operating systems as configured</li>
            <li>Reporting abnormal system behavior</li>
            <li>Following access and usage procedures</li>
          </ul>
          <p><strong>You are not responsible for</strong></p>
          <ul>
            <li>Applying patches</li>
            <li>Managing firewall rules</li>
            <li>Reviewing security logs</li>
          </ul>
          <p><strong>Evidence you touch</strong></p>
          <ul>
            <li>Operator logs</li>
            <li>Incident reports</li>
            <li>Shift handover notes</li>
          </ul>
        </div>
        <div class="card">
          <h3>System Administrators</h3>
          <p><strong>Responsible for</strong></p>
          <ul>
            <li>Ports, services, patching, accounts</li>
            <li>System hardening and access controls</li>
          </ul>
          <p><strong>Not responsible for</strong></p>
          <ul>
            <li>Operational decisions</li>
            <li>Compliance interpretation</li>
          </ul>
          <p><strong>Evidence</strong></p>
          <ul>
            <li>Configuration baselines</li>
            <li>Patch records</li>
            <li>Account lists</li>
          </ul>
        </div>
        <div class="card">
          <h3>Security Teams</h3>
          <p><strong>Responsible for</strong></p>
          <ul>
            <li>Monitoring events</li>
            <li>Malware controls</li>
            <li>Incident escalation</li>
          </ul>
          <p><strong>Evidence</strong></p>
          <ul>
            <li>SIEM logs</li>
            <li>Alerts</li>
            <li>Incident tickets</li>
          </ul>
        </div>
        <div class="card">
          <h3>Compliance / Audit</h3>
          <p><strong>Responsible for</strong></p>
          <ul>
            <li>Verifying evidence</li>
            <li>Confirming process adherence</li>
          </ul>
          <p><strong>Evidence</strong></p>
          <ul>
            <li>Reports</li>
            <li>Policies</li>
            <li>Control attestations</li>
          </ul>
        </div>
      </div>
      <div class="cta">
        <button data-prev="training-flow">Back</button>
        <button data-next="requirements-overview" class="next">Next: Requirements Overview</button>
      </div>
    </section>

    <section id="requirements-overview" class="page" data-title="Requirements Overview">
      <p class="pill">Step 3 — Map the Requirements</p>
      <h2>Requirements Overview</h2>
      <div class="table" role="table" aria-label="Requirement overview table">
        <div>Requirement</div><div>Plain-English Goal</div><div>Primary Owner</div><div>Why It Matters</div>
        <div>R1</div><div>Only necessary services are running</div><div>Sys Admin</div><div>Reduces attack surface</div>
        <div>R2</div><div>Systems are patched safely</div><div>Sys Admin</div><div>Fixes known vulnerabilities</div>
        <div>R3</div><div>Malware is prevented or detected</div><div>Security</div><div>Prevents disruption</div>
        <div>R4</div><div>Security events are monitored</div><div>Security</div><div>Detects issues early</div>
        <div>R5</div><div>Accounts are controlled</div><div>Sys Admin</div><div>Prevents unauthorized access</div>
        <div>R6</div><div>Remote access is secured</div><div>Security</div><div>Limits external risk</div>
      </div>
      <p class="lead">You are on Step 3 of 7 — review each requirement next.</p>
      <div class="cta">
        <button data-prev="role-guidance">Back</button>
        <button data-next="r1" class="next">Start Requirements</button>
      </div>
    </section>

    <section id="r1" class="page" data-title="R1 – Ports & Services">
      <p class="pill">Step 3 of 7</p>
      <h2>R1 – Ports &amp; Services</h2>
      <p class="lead">Purpose: Ensure only required network ports and services are enabled on systems.</p>
      <div class="grid two-col">
        <div class="card">
          <h3>What Can Go Wrong</h3>
          <ul>
            <li>Unused services become attack paths</li>
            <li>Increased exposure to malware or intrusion</li>
          </ul>
          <h3>What Good Looks Like</h3>
          <ul>
            <li>Services documented</li>
            <li>Unused ports disabled</li>
            <li>Changes reviewed before deployment</li>
          </ul>
        </div>
        <div class="card">
          <h3>Who Owns This</h3>
          <p>System Administrators</p>
          <h4>Evidence Examples</h4>
          <ul>
            <li>Service configuration lists</li>
            <li>Firewall rules</li>
            <li>Change records</li>
          </ul>
          <h4>Common Mistakes</h4>
          <ul>
            <li>Leaving defaults enabled</li>
            <li>No documentation</li>
            <li>Emergency changes never reviewed</li>
          </ul>
          <p><strong>You’re Done When…</strong> All enabled services are justified and documented.</p>
        </div>
      </div>
      <div class="cta">
        <button data-prev="requirements-overview">Back</button>
        <button data-next="r2" class="next">Next Requirement (R2)</button>
      </div>
    </section>

    <section id="r2" class="page" data-title="R2 – Patch Management">
      <p class="pill">Step 3 of 7</p>
      <h2>R2 – Patch Management</h2>
      <p class="lead">Purpose: Keep systems patched safely and on time.</p>
      <div class="grid two-col">
        <div class="card">
          <h3>What Can Go Wrong</h3>
          <ul>
            <li>Unpatched vulnerabilities remain exploitable</li>
            <li>Rushed changes create outages</li>
          </ul>
          <h3>What Good Looks Like</h3>
          <ul>
            <li>Patch evaluation cycle tracked</li>
            <li>Testing before production</li>
            <li>Mitigations recorded when patching is delayed</li>
          </ul>
        </div>
        <div class="card">
          <h3>Who Owns This</h3>
          <p>System Administrators</p>
          <h4>Evidence Examples</h4>
          <ul>
            <li>Vendor advisories and assessments</li>
            <li>Patch deployment tickets</li>
            <li>Mitigating measures when patches are deferred</li>
          </ul>
          <h4>Common Mistakes</h4>
          <ul>
            <li>Skipping testing on representative systems</li>
            <li>Failing to document deferrals</li>
          </ul>
          <p><strong>You’re Done When…</strong> Patches or mitigations are recorded with approvals.</p>
        </div>
      </div>
      <div class="cta">
        <button data-prev="r1">Back</button>
        <button data-next="r3" class="next">Next Requirement (R3)</button>
      </div>
    </section>

    <section id="r3" class="page" data-title="R3 – Malware Prevention">
      <p class="pill">Step 3 of 7</p>
      <h2>R3 – Malware Prevention</h2>
      <p class="lead">Purpose: Prevent or detect malware on OT systems.</p>
      <div class="grid two-col">
        <div class="card">
          <h3>What Can Go Wrong</h3>
          <ul>
            <li>Out-of-date signatures miss threats</li>
            <li>Portable media introduces malware</li>
          </ul>
          <h3>What Good Looks Like</h3>
          <ul>
            <li>Real-time protection enabled</li>
            <li>Signature updates and scans scheduled</li>
            <li>Portable media scanned on approved jump hosts</li>
          </ul>
        </div>
        <div class="card">
          <h3>Who Owns This</h3>
          <p>Security Teams</p>
          <h4>Evidence Examples</h4>
          <ul>
            <li>Signature update logs</li>
            <li>Scan results</li>
            <li>Exceptions with compensating controls</li>
          </ul>
          <h4>Common Mistakes</h4>
          <ul>
            <li>Leaving protections disabled after maintenance</li>
            <li>Skipping media scans during field work</li>
          </ul>
          <p><strong>You’re Done When…</strong> Malware controls are active or approved alternatives are documented.</p>
        </div>
      </div>
      <div class="cta">
        <button data-prev="r2">Back</button>
        <button data-next="r4" class="next">Next Requirement (R4)</button>
      </div>
    </section>

    <section id="r4" class="page" data-title="R4 – Security Event Monitoring">
      <p class="pill">Step 3 of 7</p>
      <h2>R4 – Security Event Monitoring</h2>
      <p class="lead">Purpose: Monitor security events to detect issues early.</p>
      <div class="grid two-col">
        <div class="card">
          <h3>What Can Go Wrong</h3>
          <ul>
            <li>Logs not forwarded or retained</li>
            <li>Missed alerts during busy operations</li>
          </ul>
          <h3>What Good Looks Like</h3>
          <ul>
            <li>Time-synced event collection</li>
            <li>Regular review of key events</li>
            <li>Escalation paths defined</li>
          </ul>
        </div>
        <div class="card">
          <h3>Who Owns This</h3>
          <p>Security Teams</p>
          <h4>Evidence Examples</h4>
          <ul>
            <li>Log forwarding configuration</li>
            <li>Review records</li>
            <li>Investigation tickets</li>
          </ul>
          <h4>Common Mistakes</h4>
          <ul>
            <li>Time skew between devices</li>
            <li>Overlooking service start/stop anomalies</li>
          </ul>
          <p><strong>You’re Done When…</strong> Key events are logged, reviewed, and escalated when needed.</p>
        </div>
      </div>
      <div class="cta">
        <button data-prev="r3">Back</button>
        <button data-next="r5" class="next">Next Requirement (R5)</button>
      </div>
    </section>

    <section id="r5" class="page" data-title="R5 – Account Management">
      <p class="pill">Step 3 of 7</p>
      <h2>R5 – Account Management</h2>
      <p class="lead">Purpose: Control accounts so only authorized users access OT systems.</p>
      <div class="grid two-col">
        <div class="card">
          <h3>What Can Go Wrong</h3>
          <ul>
            <li>Inactive accounts remain enabled</li>
            <li>Shared accounts hide accountability</li>
          </ul>
          <h3>What Good Looks Like</h3>
          <ul>
            <li>Joiner/mover/leaver processes enforced</li>
            <li>Regular account reviews</li>
            <li>Least privilege for daily work</li>
          </ul>
        </div>
        <div class="card">
          <h3>Who Owns This</h3>
          <p>System Administrators</p>
          <h4>Evidence Examples</h4>
          <ul>
            <li>Account review reports</li>
            <li>Access approvals</li>
            <li>Vendor account disablement proof</li>
          </ul>
          <h4>Common Mistakes</h4>
          <ul>
            <li>Using admin accounts for daily tasks</li>
            <li>Not linking tickets to account changes</li>
          </ul>
          <p><strong>You’re Done When…</strong> Accounts are current, approved, and time-bound.</p>
        </div>
      </div>
      <div class="cta">
        <button data-prev="r4">Back</button>
        <button data-next="r6" class="next">Next Requirement (R6)</button>
      </div>
    </section>

    <section id="r6" class="page" data-title="R6 – Interactive Remote Access">
      <p class="pill">Step 3 of 7</p>
      <h2>R6 – Interactive Remote Access</h2>
      <p class="lead">Purpose: Secure interactive and remote access so external risk is limited.</p>
      <div class="grid two-col">
        <div class="card">
          <h3>What Can Go Wrong</h3>
          <ul>
            <li>Legacy protocols expose sessions</li>
            <li>Temporary access not removed</li>
          </ul>
          <h3>What Good Looks Like</h3>
          <ul>
            <li>MFA on approved gateways</li>
            <li>Inactivity timeouts and lockouts</li>
            <li>Session logging or recording for vendors</li>
          </ul>
        </div>
        <div class="card">
          <h3>Who Owns This</h3>
          <p>Security Teams</p>
          <h4>Evidence Examples</h4>
          <ul>
            <li>Gateway configurations</li>
            <li>Timeout and lockout settings</li>
            <li>Session logs</li>
          </ul>
          <h4>Common Mistakes</h4>
          <ul>
            <li>Leaving temporary accounts active</li>
            <li>Allowing direct internet exposure</li>
          </ul>
          <p><strong>You’re Done When…</strong> Remote access is gated, logged, and time-bound.</p>
        </div>
      </div>
      <div class="cta">
        <button data-prev="r5">Back</button>
        <button data-next="scenarios" class="next">Next: Scenarios</button>
      </div>
    </section>

    <section id="audit-etiquette" class="page" data-title="Audit Etiquette">
      <p class="pill warning">Required for Audit Preparation</p>
      <h2>Audit Etiquette</h2>
      <p class="lead">Adapted from cip-audit-ready guidance: understand what auditors need, how to answer, and what to avoid so evidence speaks for itself.</p>
      <div class="grid two-col">
        <div class="card">
          <h3>Auditors’ objectives</h3>
          <ul>
            <li>Verify controls meet the documented requirement.</li>
            <li>Trace answers back to evidence, not opinions.</li>
            <li>Confirm consistency between practice and procedure.</li>
          </ul>
          <h3>Do</h3>
          <ul>
            <li>Answer only what is asked and pause when done.</li>
            <li>Point to records, logs, or screenshots as evidence.</li>
            <li>Use precise timing (UTC/local) and system names.</li>
          </ul>
        </div>
        <div class="card">
          <h3>Don’t</h3>
          <ul>
            <li>Speculate or guess when unsure.</li>
            <li>Volunteer unrelated issues or future plans.</li>
            <li>Use ambiguous phrases like “should be” or “maybe.”</li>
          </ul>
          <h3>Red-flag phrases</h3>
          <ul>
            <li>“We don’t usually log that.”</li>
            <li>“I think someone handled it.”</li>
            <li>“We plan to fix that later.”</li>
          </ul>
        </div>
      </div>
      <div class="card" style="margin-top:1rem;">
        <h3>Practice prompts</h3>
        <ul>
          <li>“Show how you documented a deferred patch.” → Open the ticket, state date/time, mitigation used.</li>
          <li>“How do you restrict vendor access?” → Describe gateway, MFA, time limits, and link to session log.</li>
          <li>“Walk through your log review cadence.” → Reference procedure section and last review evidence.</li>
        </ul>
      </div>
      <div class="cta">
        <button data-prev="r6">Back</button>
        <button data-next="scenarios" class="next">Next: Scenarios</button>
      </div>
    </section>

    <section id="scenarios" class="page" data-title="Scenarios">
      <p class="pill">Step 4 — Apply Through Scenarios</p>
      <h2>Scenarios</h2>
      <div class="scenario">
        <h3>Scenario 1</h3>
        <p><strong>Situation:</strong> A new service appears on a control server after maintenance.<br /><strong>What Should Happen:</strong> Service is reviewed and either approved or disabled.<br /><strong>Requirement:</strong> R1<br /><strong>Why It Matters:</strong> Prevents unintentional exposure.</p>
      </div>
      <div class="scenario">
        <h3>Scenario 2</h3>
        <p><strong>Situation:</strong> Patches are delayed for a relay workstation pending vendor testing.<br /><strong>What Should Happen:</strong> Document deferral, apply mitigating measures, and schedule deployment.<br /><strong>Requirement:</strong> R2<br /><strong>Why It Matters:</strong> Keeps vulnerabilities managed even when patching is paused.</p>
      </div>
      <div class="scenario">
        <h3>Scenario 3</h3>
        <p><strong>Situation:</strong> SOC alerts show repeated failed logons after hours.<br /><strong>What Should Happen:</strong> Escalate, review logs, and validate lockout settings.<br /><strong>Requirement:</strong> R4<br /><strong>Why It Matters:</strong> Early detection avoids compromise.</p>
      </div>
      <div class="scenario">
        <h3>Scenario 4</h3>
        <p><strong>Situation:</strong> Vendor requests short-term remote access for troubleshooting.<br /><strong>What Should Happen:</strong> Use approved gateway with MFA, time-limit the account, and record the session.<br /><strong>Requirement:</strong> R6<br /><strong>Why It Matters:</strong> Limits external risk while work proceeds.</p>
      </div>
      <div class="cta">
        <button data-prev="audit-etiquette">Back</button>
        <button data-next="knowledge-check" class="next">Next: Knowledge Check</button>
      </div>
    </section>

    <section id="knowledge-check" class="page" data-title="Knowledge Check">
      <p class="pill">Step 5 — Verify Understanding</p>
      <h2>Knowledge Check</h2>
      <p class="lead">Answer to unlock the checklist. Immediate feedback is provided and retries are allowed.</p>
      <div class="quiz" id="quiz"></div>
      <p id="quiz-status" class="lead" style="color:var(--accent-2); display:none;">Knowledge check completed — checklist unlocked.</p>
      <div class="cta">
        <button data-prev="scenarios">Back</button>
        <button data-next="operational-checklist" class="next" id="after-quiz">Next: Checklist</button>
      </div>
    </section>

    <section id="operational-checklist" class="page" data-title="Operational Checklist">
      <p class="pill">Step 6 — Download the Checklist</p>
      <h2>Operational Checklist</h2>
      <p id="checklist-lock" class="locked">Complete the knowledge check to unlock this checklist.</p>
      <div class="grid two-col" id="checklist-content" style="display:none;">
        <div class="card">
          <h3>Prevent</h3>
          <ul>
            <li>☐ Services documented (Annual)</li>
            <li>☐ Patches reviewed and applied (Monthly)</li>
            <li>☐ Malware protections active (Continuous)</li>
          </ul>
        </div>
        <div class="card">
          <h3>Detect</h3>
          <ul>
            <li>☐ Logs monitored (Daily)</li>
            <li>☐ Alerts reviewed (Daily)</li>
          </ul>
          <h3>Respond</h3>
          <ul>
            <li>☐ Incidents escalated per procedure</li>
            <li>☐ Evidence retained</li>
          </ul>
          <p style="margin-top:0.5rem;"><button style="width:100%;" aria-label="Download checklist PDF">Download PDF</button></p>
          <p><button style="width:100%;" aria-label="Print checklist">Print</button></p>
        </div>
      </div>
      <div class="cta">
        <button data-prev="knowledge-check">Back</button>
        <button data-next="resources" class="next">Next: Resources</button>
      </div>
    </section>

    <section id="resources" class="page" data-title="Resources">
      <p class="pill">Step 7 — Resources</p>
      <h2>Resources</h2>
      <ul>
        <li>Internal security policies</li>
        <li>Patch management procedures</li>
        <li>Monitoring tools used</li>
        <li>Security contact information</li>
      </ul>
      <div class="cta">
        <button data-prev="operational-checklist">Back</button>
        <button data-next="completion" class="next">Next: Completion</button>
      </div>
    </section>

    <section id="completion" class="page" data-title="Completion">
      <p class="pill">Training Complete</p>
      <h2>You have completed CIP-007 System Security Management.</h2>
      <p class="lead">Next steps: proceed to the next CIP module and apply the checklist operationally. Certificate available if enabled.</p>
      <div class="cta">
        <button data-prev="resources">Back</button>
        <button data-next="landing" class="next">Restart Module</button>
      </div>
    </section>
  </main>

  <script>
    const totalPages = 18;
    const STORAGE_KEY = 'cisr-learning-profile';
    const moduleId = 'module6-cip7';

    const sections = [
      { id: 'setup', label: 'Setup' },
      { id: 'introduction', label: 'Introduction' },
      { id: 'training-flow', label: 'Training Flow' },
      { id: 'role-guidance', label: 'Role Guidance' },
      { id: 'requirements-overview', label: 'Requirements Overview' },
      { id: 'r1', label: 'R1 – Ports & Services' },
      { id: 'r2', label: 'R2 – Patch Management' },
      { id: 'r3', label: 'R3 – Malware Prevention' },
      { id: 'r4', label: 'Security Event Monitoring' },
      { id: 'r5', label: 'Account Management' },
      { id: 'r6', label: 'Interactive Remote Access' },
      { id: 'audit-etiquette', label: 'Audit Etiquette' },
      { id: 'scenarios', label: 'Scenarios' },
      { id: 'knowledge-check', label: 'Knowledge Check' },
      { id: 'operational-checklist', label: 'Operational Checklist', locked: true },
      { id: 'resources', label: 'Resources' },
      { id: 'completion', label: 'Completion' }
    ];

    const navList = document.getElementById('nav-list');
    const pages = document.querySelectorAll('.page');
    const progressCount = document.getElementById('progress-count');
    const goalNote = document.getElementById('goal-note');

    let visited = new Set(['landing']);
    let knowledgeScore = 0;
    let knowledgeComplete = false;
    let checklistCompleted = false;
    let goal = '';
    let learnerName = '';

    function loadState() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || { learner: {}, modules: {}, certificates: [] };
      } catch (err) {
        return { learner: {}, modules: {}, certificates: [] };
      }
    }

    function saveState(state) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function currentModule(state = loadState()) {
      state.modules[moduleId] = state.modules[moduleId] || { title: 'CIP-007 System Security Management' };
      return state.modules[moduleId];
    }

    sections.forEach((section) => {
      const li = document.createElement('li');
      const btn = document.createElement('button');
      btn.textContent = section.label;
      btn.dataset.target = section.id;
      if (section.locked) btn.disabled = true;
      li.appendChild(btn);
      const mark = document.createElement('span');
      mark.className = 'check';
      mark.textContent = '✔';
      mark.style.display = 'none';
      btn.appendChild(mark);
      navList.appendChild(li);
    });

    function updateProgress() {
      progressCount.textContent = `${visited.size} / ${totalPages}`;
      document.querySelectorAll('nav button').forEach((btn) => {
        const mark = btn.querySelector('.check');
        if (visited.has(btn.dataset.target)) {
          mark.style.display = 'inline';
        }
      });

      const state = loadState();
      const module = currentModule(state);
      module.lastSection = Array.from(visited).pop();
      module.progress = Math.round((visited.size / totalPages) * 100);
      module.status = knowledgeComplete && checklistCompleted ? 'Completed' : 'In progress';
      module.knowledgeScore = knowledgeScore;
      state.modules[moduleId] = module;
      saveState(state);
    }

    function enforceGoalRules() {
      const knowledgeButton = navList.querySelector('button[data-target="knowledge-check"]');
      const auditButton = navList.querySelector('button[data-target="audit-etiquette"]');
      if (goal === 'Audit preparation') {
        goalNote.textContent = 'Audit preparation selected — Audit Etiquette becomes required before the quiz unlocks.';
        auditButton.disabled = false;
        knowledgeButton.dataset.lockedByGoal = 'true';
      } else {
        goalNote.textContent = 'Select a goal to see required steps.';
        delete knowledgeButton.dataset.lockedByGoal;
      }
    }

    function showPage(id) {
      if (id === 'knowledge-check' && goal === 'Audit preparation' && !visited.has('audit-etiquette')) {
        alert('Complete the Audit Etiquette section before starting the knowledge check.');
        return;
      }
      pages.forEach((page) => page.classList.remove('active'));
      const target = document.getElementById(id);
      if (target) {
        target.classList.add('active');
        visited.add(id);
        document.querySelectorAll('nav button').forEach((btn) => {
          btn.classList.toggle('active', btn.dataset.target === id);
        });
        updateProgress();
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    navList.addEventListener('click', (event) => {
      if (event.target.tagName === 'BUTTON') {
        const target = event.target.dataset.target;
        if (event.target.disabled) return;
        showPage(target);
      }
    });

    document.querySelectorAll('[data-next]').forEach((btn) => {
      btn.addEventListener('click', () => showPage(btn.dataset.next));
    });

    document.querySelectorAll('[data-prev]').forEach((btn) => {
      btn.addEventListener('click', () => showPage(btn.dataset.prev));
    });

    document.getElementById('start-training').addEventListener('click', () => {
      showPage('setup');
    });

    document.getElementById('save-setup').addEventListener('click', () => {
      const state = loadState();
      learnerName = document.getElementById('learner-name').value.trim() || state.learner.name || 'Learner';
      goal = document.getElementById('learner-goal').value || state.learner.goal || '';
      const role = document.getElementById('learner-role').value || state.learner.role || '';
      state.learner = { name: learnerName, goal, role };
      saveState(state);
      enforceGoalRules();
      showPage('introduction');
    });

    const quizData = [
      { q: 'Why does CIP-007 emphasize least functionality?', options: ['It speeds up networks', 'It reduces attack surface by limiting open ports and services', 'It improves user experience'], answer: 1 },
      { q: 'What should you do if a patch cannot be applied within the expected window?', options: ['Ignore it until the next cycle', 'Document the reason, apply mitigating measures, and schedule installation', 'Remove the system from service permanently'], answer: 1 },
      { q: 'How are suspicious log events handled?', options: ['Delete the logs to save space', 'Forward, review, and escalate anomalies with timestamps and details', 'Wait for monthly reviews'], answer: 1 },
      { q: 'When are shared accounts acceptable?', options: ['When convenient for teams', 'Only when technically required with approvals, logging, and time limits', 'Never under any circumstance'], answer: 1 },
      { q: 'How often should account lists be reviewed?', options: ['Every five years', 'Only after incidents', 'At least every 15 months with prompt removal of stale accounts'], answer: 2 },
      { q: 'What should you do with portable media?', options: ['Plug into any available port', 'Scan on approved jump hosts, log usage, and avoid direct insertion into BCS devices', 'Format immediately'], answer: 1 },
      { q: 'Who owns malware prevention?', options: ['Security Teams', 'Finance Teams', 'Facilities Teams'], answer: 0 },
      { q: 'Why secure interactive remote access?', options: ['To simplify vendor onboarding', 'To limit external risk with MFA, logging, and time-bound access', 'To avoid using tickets'], answer: 1 }
    ];

    const quizContainer = document.getElementById('quiz');

    quizData.forEach((item, index) => {
      const block = document.createElement('div');
      block.className = 'question';
      const title = document.createElement('strong');
      title.textContent = `${index + 1}. ${item.q}`;
      block.appendChild(title);

      const options = document.createElement('div');
      options.className = 'options';

      item.options.forEach((opt, optIndex) => {
        const btn = document.createElement('button');
        btn.textContent = opt;
        btn.addEventListener('click', () => {
          const buttons = options.querySelectorAll('button');
          buttons.forEach((b) => b.classList.remove('correct', 'incorrect'));
          if (optIndex === item.answer) {
            btn.classList.add('correct');
            block.querySelector('.feedback').textContent = 'Correct. Keep going!';
          } else {
            btn.classList.add('incorrect');
            block.querySelector('.feedback').textContent = 'Not quite. Try again.';
          }
        });
        options.appendChild(btn);
      });
      block.appendChild(options);
      const feedback = document.createElement('p');
      feedback.className = 'feedback';
      feedback.textContent = 'Select an answer to see feedback.';
      block.appendChild(feedback);
      quizContainer.appendChild(block);
    });

    function evaluateQuiz() {
      const answeredCorrect = Array.from(document.querySelectorAll('.question')).filter((q, idx) => {
        const correctBtn = q.querySelectorAll('button')[quizData[idx].answer];
        return correctBtn.classList.contains('correct');
      }).length;
      knowledgeScore = Math.round((answeredCorrect / quizData.length) * 100);
      const status = document.getElementById('quiz-status');
      status.style.display = 'block';
      status.textContent = `Knowledge check scored ${knowledgeScore}% (${answeredCorrect} of ${quizData.length}).`;
      if (knowledgeScore >= 80) {
        knowledgeComplete = true;
        document.getElementById('checklist-lock').style.display = 'none';
        document.getElementById('checklist-content').style.display = 'grid';
        const checklistButton = navList.querySelector('button[data-target="operational-checklist"]');
        checklistButton.disabled = false;
      } else {
        knowledgeComplete = false;
        checklistCompleted = false;
        document.getElementById('checklist-lock').style.display = 'block';
        document.getElementById('checklist-content').style.display = 'none';
        navList.querySelector('button[data-target="operational-checklist"]').disabled = true;
      }
      updateProgress();
    }

    document.getElementById('after-quiz').addEventListener('click', (event) => {
      if (!knowledgeComplete) {
        event.preventDefault();
        alert('Score at least 80% on the knowledge check to proceed to the checklist.');
        return;
      }
      showPage('operational-checklist');
    });

    document.getElementById('after-quiz').insertAdjacentHTML('beforebegin', '<button style="width:100%;" id="grade-quiz">Grade knowledge check</button>');
    document.getElementById('grade-quiz').addEventListener('click', evaluateQuiz);

    document.getElementById('checklist-content').insertAdjacentHTML('beforeend', '<p style="margin-top:0.5rem;"><button id="mark-checklist" style="width:100%;">Mark checklist completed</button><span id="checklist-status" class="lead" style="display:block;margin-top:0.35rem;"></span></p>');
    document.getElementById('mark-checklist').addEventListener('click', () => {
      if (!knowledgeComplete) {
        alert('Finish the knowledge check first.');
        return;
      }
      checklistCompleted = true;
      document.getElementById('checklist-status').textContent = 'Checklist completed and logged locally.';
      maybeGenerateCertificate();
      updateProgress();
    });

    function maybeGenerateCertificate() {
      if (!knowledgeComplete || !checklistCompleted) return;
      const state = loadState();
      const module = currentModule(state);
      const issuedAt = new Date();
      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      const displayDate = issuedAt.toLocaleString([], { dateStyle: 'medium', timeStyle: 'short' });
      learnerName = document.getElementById('learner-name').value.trim() || state.learner.name || 'Learner';
      module.status = 'Completed';
      module.knowledgeScore = knowledgeScore;
      module.completedAt = issuedAt.toISOString();
      module.lastSection = 'completion';

      const certificateText = `CIP-007 System Security Management
Learner: ${learnerName}
Goal: ${goal || 'Not specified'}
Completed: ${displayDate} (${timezone})
Knowledge Check: ${knowledgeScore}%
Checklist: Completed`;
      const blob = new Blob([certificateText], { type: 'text/plain' });
      const link = URL.createObjectURL(blob);
      const filename = `${learnerName.replace(/\s+/g, '-')}-CIP007-certificate.txt`;
      const certRecord = {
        module: 'CIP-007 System Security Management',
        name: learnerName,
        date: `${displayDate} (${timezone})`,
        link,
        filename
      };

      state.modules[moduleId] = module;
      const existing = state.certificates.find((c) => c.filename === filename);
      if (!existing) state.certificates.push(certRecord);
      saveState(state);

      const completionArea = document.getElementById('completion');
      if (!completionArea.querySelector('#download-certificate')) {
        completionArea.insertAdjacentHTML('beforeend', `<div class="card" style="margin-top:1rem;"><h3>Certificate ready</h3><p class="lead">Download your personalized certificate or access it from the My Learning dashboard.</p><a class="link-btn" id="download-certificate" href="${link}" download="${filename}">Download Certificate</a></div>`);
      } else {
        const download = document.getElementById('download-certificate');
        download.href = link;
        download.download = filename;
      }
    }

    document.getElementById('back-to-top')?.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

    const initialState = loadState();
    learnerName = initialState.learner.name || '';
    goal = initialState.learner.goal || '';
    document.getElementById('learner-name').value = learnerName;
    document.getElementById('learner-goal').value = goal;
    document.getElementById('learner-role').value = initialState.learner.role || '';
    enforceGoalRules();
    updateProgress();
  </script>
  <button class="back-top" id="back-to-top" aria-label="Back to top">↑ Back to top</button>
</body>
</html>
